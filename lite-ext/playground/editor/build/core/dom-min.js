KISSY.Editor.add("dom",function(p){function v(a){return a.replace(/-(\w)/g,function(b,c){return c.toUpperCase()})}var o=KISSY,i=o.DOM,j=o.UA,n=o.Node,u=p.Utils,w={abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};p.NODE={NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11};p.POSITION={};var k=p.NODE,l=p.POSITION;l.POSITION_IDENTICAL=0;l.POSITION_DISCONNECTED=
1;l.POSITION_FOLLOWING=2;l.POSITION_PRECEDING=4;l.POSITION_IS_CONTAINED=8;l.POSITION_CONTAINS=16;var q={},x={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},g=function(a){return a[0]||a},r=function(a){if(a&&!a[0])return new n(a);return a},t={_4e_wrap:r,_4e_equals:function(a,b){if(!a&&!b)return true;if(!a||!b)return false;a=g(a);b=g(b);return a===b},_4e_isBlockBoundary:function(a,
b){a=r(a);var c=o.mix(o.mix({},y),b||{});return x[a.css("display")]||c[a._4e_name()]},_4e_getWin:function(a){return a&&"scrollTo"in a&&a.document?a:a&&a.nodeType===9?a.defaultView||a.parentWindow:false},_4e_index:function(a){a=g(a);for(var b=a.parentNode.childNodes,c=0;c<b.length;c++)if(b[c]===a)return c;return-1},_4e_first:function(a,b){a=g(a);var c=a.firstChild;if((c=c&&new n(c))&&b&&!b(c))c=c._4e_next(b);return c},_4e_move:function(a,b,c){a._4e_remove();a=g(a);b=g(b);c?b.insertBefore(a,b.firstChild):
b.appendChild(a)},_4e_name:function(a){a=g(a);var b=a.nodeName.toLowerCase();if(j.ie)if((a=a.scopeName)&&a!="HTML")b=a.toLowerCase()+":"+b;return b},_4e_isIdentical:function(a,b){if(a._4e_name()!=b._4e_name())return false;var c=a[0].attributes,d=b[0].attributes,e=c.length,f=d.length;if(!j.ie&&e!=f)return false;for(var h=0;h<e;h++){var m=c[h];if((!j.ie||m.specified&&m.nodeName!="_ke_expando")&&m.nodeValue!=b.attr(m.nodeName))return false}if(j.ie)for(h=0;h<f;h++){m=d[h];if(m.specified&&m.nodeName!=
"_ke_expando"&&m.nodeValue!=a.attr(m.nodeName))return false}return true},_4e_isEmptyInlineRemoveable:function(a){a=g(a).childNodes;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.nodeType;if(!(e==k.NODE_ELEMENT&&d.getAttribute("_ke_bookmark")))if(e==k.NODE_ELEMENT&&!t._4e_isEmptyInlineRemoveable(d)||e==k.NODE_TEXT&&o.trim(d.nodeValue))return false}return true},_4e_moveChildren:function(a,b,c){a=g(a);b=b[0]||b;if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),b.firstChild);else for(;c=
a.firstChild;)b.appendChild(a.removeChild(c))},_4e_mergeSiblings:function(){function a(b,c,d){if(c[0]&&c[0].nodeType==k.NODE_ELEMENT){for(var e=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemoveable();){e.push(c);c=d?new n(c[0].nextSibling):new n(c[0].previousSibling);if(!c[0]||c[0].nodeType!=k.NODE_ELEMENT)return}if(b._4e_isIdentical(c)){for(var f=d?b[0].lastChild:b[0].firstChild;e.length;)e.shift()._4e_move(b,!d);c._4e_moveChildren(b,!d);c._4e_remove();f[0]&&f[0].nodeType==k.NODE_ELEMENT&&f._4e_mergeSiblings()}}}
return function(b){if(b[0])if(w[b._4e_name()]||b._4e_name()=="a"){a(b,new n(b[0].nextSibling),true);a(b,new n(b[0].previousSibling))}}}(),_4e_unselectable:j.gecko?function(a){a=g(a);a.style.MozUserSelect="none"}:j.webkit?function(a){a=g(a);a.style.KhtmlUserSelect="none"}:function(a){a=g(a);if(j.ie||j.opera){var b,c=0;for(a.unselectable="on";b=a.all[c++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}},_4e_getOffset:function(a,
b){a=g(a);var c,d=0;c=0;var e=a.ownerDocument.defaultView||a.ownerDocument.parentWindow,f=a.ownerDocument,h=f.documentElement;b=b||f;if(a.getBoundingClientRect){if(a!==f.body&&h!==a){c=a.getBoundingClientRect();d=c.left+(b===f?i.scrollLeft(e):0);c=c.top+(b===f?i.scrollTop(e):0)}if(b)if(e!=(b.defaultView||b.parentWindow)&&e.frameElement){e=t._4e_getOffset(e.frameElement,b);d+=e.left;c+=e.top}}return{left:d,top:c}},_4e_getFrameDocument:function(a){return(a=g(a))&&a.contentWindow.document},_4e_splitText:function(a,
b){a=g(a);var c=a.ownerDocument;if(!(!a||a.nodeType!=k.NODE_TEXT)){if(j.ie&&b==a.nodeValue.length){var d=c.createTextNode("");i.insertAfter(d,a);return d}d=new n(a.splitText(b));if(j.ie==8){c=c.createTextNode("");i.insertAfter(c,d[0]);c.parentNode.removeChild(c)}return d}},_4e_parents:function(a,b){a=r(a);var c=[];do c[b?"push":"unshift"](a);while(a=a.parent());return c},_4e_clone:function(a,b,c){a=g(a);a=a.cloneNode(b);if(!c){var d=function(e){if(e.nodeType==k.NODE_ELEMENT){e.removeAttribute("id",
false);e.removeAttribute("_ke_expando",false);e=e.childNodes;for(var f=0;f<e.length;f++)d(e[f])}};d(a)}return new n(a)},_4e_nextSourceNode:function(a,b,c,d){a=g(a);if(d&&!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.firstChild;var f=new n(a);if(!b){if(a.nodeType==k.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.nextSibling}for(;!b&&(f=f.parent());){if(d&&d(f,true)===false)return null;b=f[0].nextSibling}if(!b)return null;b=i._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&
c!=b[0].nodeType)return b._4e_nextSourceNode(false,c,d);return b},_4e_previousSourceNode:function(a,b,c,d){a=g(a);if(d&&!d.call){var e=d[0]||d;d=function(h){h=h[0]||h;return h!==e}}b=!b&&a.lastChild;var f=new n(a);if(!b){if(a.nodeType==k.NODE_ELEMENT&&d&&d(a,true)===false)return null;b=a.previousSibling}for(;!b&&(f=f.parent());){if(d&&d(f,true)===false)return null;b=f[0].previousSibling}if(!b)return null;b=i._4e_wrap(b);if(d&&d(b)===false)return null;if(c&&b[0].nodeType!=c)return b._4e_previousSourceNode(false,
c,d);return b},_4e_contains:j.ie||j.webkit?function(a,b){a=g(a);b=g(b);return b.nodeType!=k.NODE_ELEMENT?a.contains(b.parentNode):a!=b&&a.contains(b)}:function(a,b){a=g(a);b=g(b);return!!(a.compareDocumentPosition(b)&16)},_4e_commonAncestor:function(a,b){if(a._4e_equals(b))return a;if(b[0].nodeType!=k.NODE_TEXT&&b._4e_contains(a))return b;var c=a[0].nodeType==k.NODE_TEXT?a.parent():a;do if(c[0].nodeType!=k.NODE_TEXT&&c._4e_contains(b))return c;while(c=c.parent());return null},_4e_ascendant:function(a,
b,c){a=g(a);if(!c)a=a.parentNode;if(b&&!o.isFunction(b)){var d=b;b=function(e){return e._4e_name()==d}}for(;a&&a.nodeType!=9;){if(!b||b(new n(a))===true)return new n(a);a=a.parentNode}return null},_4e_hasAttribute:function(a,b){a=g(a);var c=a.attributes.getNamedItem(b);return!!(c&&c.specified)},_4e_hasAttributes:j.ie?function(a){a=g(a);for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];switch(d.nodeName){case "class":if(a.getAttribute("class"))return true;break;case "_ke_expando":continue;default:if(d.specified)return true}}return false}:
function(a){a=g(a);j.gecko&&a.removeAttribute("_moz_dirty");a=a.attributes;return a.length>1||a.length==1&&a[0].nodeName!="_ke_expando"},_4e_position:function(a,b){var c=g(a),d=g(b);if(c.compareDocumentPosition)return c.compareDocumentPosition(d);if(c==d)return l.POSITION_IDENTICAL;if(c.nodeType==k.NODE_ELEMENT&&d.nodeType==k.NODE_ELEMENT){if(c.contains){if(c.contains(d))return l.POSITION_CONTAINS+l.POSITION_PRECEDING;if(d.contains(c))return l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING}if("sourceIndex"in
c)return c.sourceIndex<0||d.sourceIndex<0?l.POSITION_DISCONNECTED:c.sourceIndex<d.sourceIndex?l.POSITION_PRECEDING:l.POSITION_FOLLOWING}c=a._4e_address();d=b._4e_address();for(var e=Math.min(c.length,d.length),f=0;f<=e-1;f++)if(c[f]!=d[f]){if(f<e)return c[f]<d[f]?l.POSITION_PRECEDING:l.POSITION_FOLLOWING;break}return c.length<d.length?l.POSITION_CONTAINS+l.POSITION_PRECEDING:l.POSITION_IS_CONTAINED+l.POSITION_FOLLOWING},_4e_address:function(a,b){a=g(a);for(var c=[],d=a.ownerDocument.documentElement,
e=a;e&&e!=d;){var f=e.parentNode,h=-1;if(f){for(var m=0;m<f.childNodes.length;m++){var s=f.childNodes[m];if(!(b&&s.nodeType==3&&s.previousSibling&&s.previousSibling.nodeType==3)){h++;if(s==e)break}}c.unshift(h)}e=f}return c},_4e_breakParent:function(a,b){var c=new p.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(b);var d=c.extractContents();c.insertNode(a._4e_remove());a[0].parentNode.insertBefore(d,a[0].nextSibling)},_4e_style:function(a,b,c){if(c!==undefined)return a.css(b,c);a=a[0]||
a;return a.style[v(b)]},_4e_remove:function(a,b){var c=g(a),d=c.parentNode;if(d){if(b)for(var e;e=c.firstChild;)d.insertBefore(c.removeChild(e),c);d.removeChild(c)}return a},_4e_trim:function(a){i._4e_ltrim(a);i._4e_rtrim(a)},_4e_ltrim:function(a){a=g(a);for(var b;b=a.firstChild;){if(b.nodeType==k.NODE_TEXT){var c=u.ltrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new n(b))._4e_splitText(d-c.length);a.removeChild(a.firstChild)}}else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){a=
g(a);for(var b;b=a.lastChild;){if(b.type==k.NODE_TEXT){var c=u.rtrim(b.nodeValue),d=b.nodeValue.length;if(c){if(c.length<d){(new n(b))._4e_splitText(c.length);a.removeChild(a.lastChild)}}else{a.removeChild(b);continue}}break}if(!j.ie&&!j.opera)(b=a.lastChild)&&b.nodeType==1&&b.nodeName.toLowerCase()=="br"&&b.parentNode.removeChild(b)},_4e_appendBogus:function(a){a=g(a);for(var b=a.lastChild;b&&b.nodeType==k.NODE_TEXT&&!o.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==k.NODE_TEXT||i._4e_name(b)!==
"br"){b=j.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br");j.gecko&&b.setAttribute("type","_moz");a.appendChild(b)}},_4e_previous:function(a,b){var c=g(a),d;do d=(c=c.previousSibling)&&new n(c);while(d&&b&&!b(d));return d},_4e_last:function(a,b){a=i._4e_wrap(a);var c=a[0].lastChild;if((c=c&&new n(c))&&b&&!b(c))c=c._4e_previous(b);return c},_4e_next:function(a,b){var c=g(a),d;do d=(c=c.nextSibling)&&new n(c);while(d&&b&&!b(d));return d},_4e_outerHtml:function(a){a=g(a);
if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML},_4e_setMarker:function(a,b,c,d){a=i._4e_wrap(a);var e=a._4e_getData("list_marker_id")||a._4e_setData("list_marker_id",o.guid())._4e_getData("list_marker_id"),f=a._4e_getData("list_marker_names")||a._4e_setData("list_marker_names",{})._4e_getData("list_marker_names");b[e]=a;f[c]=1;return a._4e_setData(c,d)},_4e_clearMarkers:function(a,b,c){a=r(a);
var d=a._4e_getData("list_marker_names"),e=a._4e_getData("list_marker_id"),f;for(f in d)a._4e_removeData(f);a._4e_removeData("list_marker_names");if(c){a._4e_removeData("list_marker_id");delete b[e]}},_4e_setData:function(a,b,c){var d=i._4e_getUniqueId(a);(q[d]||(q[d]={}))[b]=c;return a},_4e_getData:function(a,b){a=g(a);var c=a.getAttribute("_ke_expando");return(c=c&&q[c])&&c[b]},_4e_removeData:function(a,b){a=g(a);var c=a.getAttribute("_ke_expando");var d=(c=c&&q[c])&&c[b];typeof d!="undefined"&&
c&&delete c[b];o.isEmptyObject(c)&&i._4e_clearData(a);return d||null},_4e_clearData:function(a){a=g(a);var b=a.getAttribute("_ke_expando");b&&delete q[b];b&&a.removeAttribute("_ke_expando")},_4e_getUniqueId:function(a){a=g(a);var b=a.getAttribute("_ke_expando");if(b)return b;b=o.guid();a.setAttribute("_ke_expando",b);return b},_4e_copyAttributes:function(a,b,c){a=g(a);var d=a.attributes;c=c||{};for(var e=0;e<d.length;e++){var f=d[e],h=f.nodeName.toLowerCase(),m;if(!(h in c))if(h=="checked"&&(m=i.attr(a,
h)))b.attr(h,m);else if(f.specified||j.ie&&f.nodeValue&&h=="value"){m=i.attr(a,h);if(m===null)m=f.nodeValue;b.attr(h,m)}}if(a.style.cssText!=="")b[0].style.cssText=a.style.cssText},_4e_isEditable:function(a){a=i._4e_name(a);var b=p.XHTML_DTD;return(a=!b.$nonEditable[a]&&(b[a]||b.span))&&a["#"]},_4e_scrollIntoView:function(a){a=r(a);var b=a[0].ownerDocument,c=i.scrollLeft(b),d=i.scrollTop(b),e=a.offset(),f=e.left;e=e.top;if(i.viewportHeight(b)+d<e||e<d||i.viewportWidth(b)+c<f||f<c)a.scrollIntoView(b)},
_4e_getElementsByTagName:function(a,b,c){a=g(a);if(!j.ie&&c)b=c+":"+b;c=[];a=a.getElementsByTagName(b);for(b=0;b<a.length;b++)c.push(new n(a[b]));return c}};o.DOM._4e_inject=function(a){o.mix(i,a);for(var b in a)a.hasOwnProperty(b)&&function(c){n.prototype[c]=function(){var d=[].slice.call(arguments,0);d.unshift(this);return a[c].apply(null,d)}}(b)};o.DOM._4e_inject(t)});
